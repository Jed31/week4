<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <title>How long have you lived.will live on earth?</title>
</head>
<body style="margin:0; min-height:100vh;">
  <table width="100%" style="height:80vh" border="0" cellspacing="0" cellpadding="0">
    <tr>
      <td align="center" valign="middle">
        <div style="text-align:center">
          <h1>How long have you lived on Earth?</h1>
          <label>지구에 떨어진 날: <input id="dob" type="date"></label>
          <label>배경색: <input id="bgc" type="color" value="#f0f9ff"></label>
          <button id="calcBtn" type="button">확인</button>
          <p id="lived" hidden>살아온 날: </p>
          <p id="left"  hidden>남은 날: </p>
        </div>
      </td>
    </tr>
  </table>

  <div style="height:120vh;"></div>

  
  <section id="photoSection" hidden style="padding:24px 0; text-align:center;">
    <div id="caption"
         style="color:#111; font-weight:200; font-size:64px; line-height:1; margin-bottom:30px;">
      괜잖아! 그래서 아직 한참이나 남았네! 
    </div>
    <img
      id="pic"
      src="https://img1.daumcdn.net/thumb/S1200x630/?fname=https://t1.daumcdn.net/news/202502/05/NEWS1/20250205070015810sjlq.jpg"
      alt="이미지"
      width="800">
  </section>

  <div id="musicWrap" hidden style="position:sticky; bottom:12px; width:100%; text-align:center;">
    <audio id="music" src="chillguys.mp3" loop preload="auto" playsinline></audio>
  </div>

  <script>
    var dobInput = document.getElementById('dob');
    var colorInput = document.getElementById('bgc');
    var livedEl  = document.getElementById('lived');
    var leftEl   = document.getElementById('left');
    var btn      = document.getElementById('calcBtn');
    var photoSec = document.getElementById('photoSection');
    var musicWrap= document.getElementById('musicWrap');
    var music    = document.getElementById('music');

    function daysBetween(a, b) {
      var ms = 1000 * 60 * 60 * 24;
      var A = Date.UTC(a.getFullYear(), a.getMonth(), a.getDate());
      var B = Date.UTC(b.getFullYear(), b.getMonth(), b.getDate());
      return Math.round((B - A) / ms);
    }

    var started = false, io = null;
    function startMusicOnce(){
      if (started) return;
      started = true;
      try {
        music.muted = true;
        music.load();
        var p = music.play();
        if (p && p.then) { p.then(function(){ setTimeout(function(){ music.muted = false; }, 150); }); }
      } catch(e) {}
    }
    function attachObserver(){
      if (io) { try { io.disconnect(); } catch(e) {} }
      io = new IntersectionObserver(function(entries){
        entries.forEach(function(entry){
          if (entry.isIntersecting) {
            startMusicOnce();
            try { io.disconnect(); } catch(e) {}
          }
        });
      }, { root: null, threshold: 0.5 });
      io.observe(document.getElementById('pic'));
    }

    function calc() {
      livedEl.hidden = true;
      leftEl.hidden  = true;
      photoSec.hidden = true;
      musicWrap.hidden = true;
      try { music.pause(); music.currentTime = 0; } catch(e) {}
      started = false;

      var dob = new Date(dobInput.value);
      if (isNaN(dob)) { dobInput.focus(); return; }

      document.body.style.backgroundColor = colorInput.value;

      var today = new Date();
      var livedDays = Math.max(0, daysBetween(dob, today));
      var end = new Date(dob); end.setFullYear(end.getFullYear() + 80);
      var remainDays = daysBetween(today, end); if (remainDays < 0) remainDays = 0;

      livedEl.textContent = livedDays + '일 동안 지구에 계셨군';
      leftEl.textContent  = '남은 날: ' + remainDays + '일';

      livedEl.hidden = false;
      leftEl.hidden  = false;
      photoSec.hidden = false;
      musicWrap.hidden = false;

      attachObserver();
    }

    btn.addEventListener('click', calc);
    dobInput.addEventListener('keydown', function(e){ if (e.key === 'Enter') { btn.click(); }});
  </script>
</body>
</html>
